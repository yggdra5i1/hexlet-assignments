# frozen_string_literal: true

require 'forwardable'
require 'uri'

# BEGIN
class Url
  extend Forwardable
  attr_reader :query_params
  def_delegators :@uri, :scheme, :host, :port

  def initialize(address)
    @address = address
    @uri = URI(address)
    @query_params = extract_query_params(address)
  end

  def query_param(key, default = nil)
    query_params.fetch(key, default)
  end

  private

  def extract_query_params(address)
    _, query_params_str = address.split('?').last
    return {} if query_params_str.nil?

    splitted_params = query_params_str.split('&')
    key_value_pairs = splitted_params.map do |param|
      k, v = param.split('=')
      [k.to_sym, v]
    end
    Hash[key_value_pairs]
  end
end
# END
